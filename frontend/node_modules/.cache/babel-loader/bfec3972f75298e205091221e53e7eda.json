{"ast":null,"code":"import _objectSpread from\"C:/SSAFY/WORKSPACE/NFT/S06P22A106/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/SSAFY/WORKSPACE/NFT/S06P22A106/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/SSAFY/WORKSPACE/NFT/S06P22A106/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"C:\\\\SSAFY\\\\WORKSPACE\\\\NFT\\\\S06P22A106\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import*as Yup from'yup';import{motion}from'framer-motion';import{LoadingButton}from'@mui/lab';import{MotionContainer,varBounceIn}from'../components/animate';import{Box,Button,Card,Container,Divider,Modal,Stack,TextField,Typography}from'@mui/material';import{Form,FormikProvider,useFormik}from'formik';import{useState,useRef}from'react';import{Link as RouterLink}from'react-router-dom';import axios from'axios';import Web3 from'web3';import COMMON_ABI from'../common/ABI';import COMMON_HEADER from'../common/HeaderType';import{onResponse,onContractCall}from'../common/ErrorMessage';import getAddressFrom from'../utils/AddressExtractor';import sendTransaction from'../utils/TxSender';import Page from'../components/Page';/**\r\n * [등록하기]를 위한 UI와 기능\r\n */import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ItemRegistration=function ItemRegistration(){// [변수] 아이템 (파일, 이름, input 클릭 참조), 작가명, 제목, 아이템 소개, 토큰 ID\nvar _useState=useState(''),_useState2=_slicedToArray(_useState,2),item=_useState2[0],setItem=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),itemName=_useState4[0],setItemName=_useState4[1];var itemSelect=useRef();var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),author=_useState6[0],setAuthor=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),title=_useState8[0],setTitle=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),description=_useState10[0],setDescription=_useState10[1];var _useState11=useState(''),_useState12=_slicedToArray(_useState11,2),tokenId=_useState12[0],setTokenId=_useState12[1];// [변수] 등록 승인 모달 (모달, 개인키, 등록 로딩, 완료 여부)\nvar _useState13=useState(false),_useState14=_slicedToArray(_useState13,2),approveModal=_useState14[0],setApproveModal=_useState14[1];var _useState15=useState(''),_useState16=_slicedToArray(_useState15,2),privKey=_useState16[0],setPrivKey=_useState16[1];var _useState17=useState(false),_useState18=_slicedToArray(_useState17,2),loading=_useState18[0],setLoading=_useState18[1];var _useState19=useState(false),_useState20=_slicedToArray(_useState19,2),isComplete=_useState20[0],setIsComplete=_useState20[1];// Web3\nvar web3=new Web3(new Web3.providers.HttpProvider(process.env.REACT_APP_ETHEREUM_RPC_URL));// 타이핑 헬퍼\nvar typeSchema=Yup.object().shape({author:Yup.string().required('작가명을 입력해주세요.'),title:Yup.string().required('제목을 입력해주세요.')});// 입력 데이터 처리\nvar formik=useFormik({initialValues:{author:'',title:'',description:''},validationSchema:typeSchema,onSubmit:function onSubmit(value){setAuthor(value.author);setTitle(value.title);setDescription(value.description);}});var errors=formik.errors,touched=formik.touched,handleSubmit=formik.handleSubmit,handleReset=formik.handleReset,getFieldProps=formik.getFieldProps;// 찾기 버튼 클릭 핸들링\nvar handleClick=function handleClick(){itemSelect.current.click();};// 아이템 업로드 핸들링\nvar handleItem=function handleItem(value){setItem(value);if(value!=='')setItemName(value.name);else setItemName('');};// 모달 핸들링 (등록 승인)\nvar toggleApprove=function toggleApprove(){setApproveModal(!approveModal);};// 개인키 입력 핸들링\nvar handlePrivKey=function handlePrivKey(e){setPrivKey(e.target.value);};/**\r\n   * PJT Ⅱ - 과제 1: 작품 등록 및 NFT 생성 \r\n   * Req.1-F1 작품 등록 화면 및 등록 요청 \r\n   * \r\n   * 구현 예)\r\n   * 1. 아이템 업로드 및 모든 정보가 입력되면 등록 승인을 위한 모달창이 열립니다.\r\n   * 2. 해당 모달 창에서 개인키를 입력하면 getAddressFrom() 함수를 통해 공개키가 반환되며, 공개키가 유효한 경우 작가명, 제목,\r\n   * 아이템 소개 정보를 인코딩하여 formData에 아이템의 이미지와 함께 append 합니다.\r\n   * 3. 만들어진 formData는 아이템 등록 API를 통해 전달되고, 정상적으로 반영된 경우 이미지의 링크와 item ID를 반환 받습니다.\r\n   * 4. 이후 공개키와 생성된 item ID, 이미지 링크를 이용해 NFT 생성을 위한 함수를 호출합니다.\r\n   * 정상적으로 트랜잭션이 완결된 후 token Id가 반환됩니다.\r\n   * 5. 정상 동작 시 token Id와 owner_address를 백엔드에 업데이트 요청합니다.  \r\n   */var addItem=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:case\"end\":return _context.stop();}}},_callee);}));return function addItem(){return _ref.apply(this,arguments);};}();return/*#__PURE__*/_jsx(Page,{title:\"SSAFY NFT\",maxWidth:\"100%\",minHeight:\"100%\",children:isComplete===false?/*#__PURE__*/_jsxs(Container,{sx:{pt:3,pl:10,pr:10},children:[/*#__PURE__*/_jsx(Typography,{variant:\"h3\",sx:{pb:6,pr:10},children:\"\\uB2F9\\uC2E0\\uC758 \\uC544\\uC774\\uD15C\\uC744 \\uB4F1\\uB85D\\uD558\\uC138\\uC694.\"}),/*#__PURE__*/_jsx(FormikProvider,{value:formik,children:/*#__PURE__*/_jsxs(Form,{autoComplete:\"off\",noValidate:true,onSubmit:handleSubmit,onReset:handleReset,children:[/*#__PURE__*/_jsxs(Stack,{spacing:3,children:[/*#__PURE__*/_jsxs(Stack,{direction:\"row\",alignItems:\"center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\"image/png, image/jpeg, image/jpg, image/gif\",ref:itemSelect,onChange:function onChange(e){return e.target.files.length!==0?handleItem(e.target.files[0]):handleItem('');},style:{display:'none'}}),/*#__PURE__*/_jsx(TextField,{sx:{width:'60%'},type:\"text\",label:\"\\uC544\\uC774\\uD15C (\\uC5C5\\uB85C\\uB4DC \\uD655\\uC7A5\\uC790 \\uD615\\uC2DD: png, jpeg, jpg, gif)\",value:itemName,disabled:true}),/*#__PURE__*/_jsx(Button,{sx:{ml:5,fontSize:18},variant:\"contained\",size:\"large\",onClick:handleClick,children:\"\\uCC3E\\uAE30\"})]}),/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({sx:{width:'70%'},inputProps:{maxLength:20},type:\"text\",label:\"\\uC791\\uAC00\\uBA85\"},getFieldProps('author')),{},{error:Boolean(touched.author&&errors.author),helperText:touched.author&&errors.author})),/*#__PURE__*/_jsx(TextField,_objectSpread(_objectSpread({sx:{width:'70%'},inputProps:{maxLength:140},type:\"text\",label:\"\\uC81C\\uBAA9\"},getFieldProps('title')),{},{error:Boolean(touched.title&&errors.title),helperText:touched.title&&errors.title})),/*#__PURE__*/_jsx(TextField,_objectSpread({sx:{width:'70%'},inputProps:{maxLength:20},type:\"text\",multiline:true,label:\"\\uC544\\uC774\\uD15C \\uC18C\\uAC1C (Option)\"},getFieldProps('description')))]}),/*#__PURE__*/_jsx(Divider,{sx:{mt:5,width:'70%'}}),/*#__PURE__*/_jsxs(Stack,{alignItems:\"center\",children:[/*#__PURE__*/_jsx(Button,{sx:{mt:5,width:'40%',fontSize:18},size:\"large\",type:\"submit\",variant:\"contained\",onClick:Object.keys(touched).length&&!Object.keys(errors).length&&item.length!==0?toggleApprove:null,children:\"\\uB4F1\\uB85D\"}),/*#__PURE__*/_jsx(Modal,{open:approveModal,children:/*#__PURE__*/_jsxs(Card,{sx:{width:'40%',border:1,borderRadius:1,borderColor:'grey.main',backgroundColor:'#ffffff',top:'25%',left:'30%'},children:[/*#__PURE__*/_jsx(Box,{children:/*#__PURE__*/_jsx(Typography,{sx:{ml:3,pt:2},variant:\"h5\",children:\"\\uB4F1\\uB85D \\uC2B9\\uC778\\uD558\\uAE30\"})}),/*#__PURE__*/_jsx(Divider,{sx:{mt:2}}),/*#__PURE__*/_jsx(FormikProvider,{value:formik,children:/*#__PURE__*/_jsx(Form,{autoComplete:\"off\",noValidate:true,onSubmit:handleSubmit,onReset:handleReset,children:/*#__PURE__*/_jsxs(Box,{sx:{mt:4,ml:3,mr:3},children:[/*#__PURE__*/_jsx(Stack,{direction:\"row\",sx:{mt:3},children:/*#__PURE__*/_jsx(TextField,{fullWidth:true,type:\"text\",label:\"\\uAC1C\\uC778\\uD0A4\",onChange:handlePrivKey,value:privKey})}),/*#__PURE__*/_jsx(Divider,{sx:{mt:4}}),/*#__PURE__*/_jsxs(Stack,{direction:\"row\",sx:{mt:3,mb:3},justifyContent:\"center\",children:[loading===false?/*#__PURE__*/_jsx(Button,{size:\"large\",variant:\"contained\",sx:{width:'20%',fontSize:16},onClick:toggleApprove,children:\"\\uCDE8\\uC18C\"}):null,/*#__PURE__*/_jsx(LoadingButton,{size:\"large\",variant:\"contained\",sx:{ml:3,width:'20%',fontSize:16},loading:loading,onClick:addItem,children:\"\\uC2B9\\uC778\\uD558\\uAE30\"})]})]})})})]})})]})]})})]}):/*#__PURE__*/_jsx(Container,{children:/*#__PURE__*/_jsx(MotionContainer,{initial:\"initial\",sx:{mt:5},open:true,children:/*#__PURE__*/_jsxs(Box,{sx:{maxWidth:480,margin:'auto',textAlign:'center'},children:[/*#__PURE__*/_jsx(motion.div,{variants:varBounceIn,children:/*#__PURE__*/_jsx(Typography,{variant:\"h3\",paragraph:true,children:\"\\uC544\\uC774\\uD15C \\uB4F1\\uB85D\\uC774 \\uC644\\uB8CC\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4.\"})}),/*#__PURE__*/_jsx(Typography,{sx:{color:'text.secondary'},children:\"\\uD310\\uB9E4 \\uB4F1\\uB85D\\uC744 \\uC774\\uC5B4\\uC11C \\uD558\\uC2DC\\uB824\\uBA74 \\uB2E4\\uC74C \\uD398\\uC774\\uC9C0\\uB85C \\uC774\\uB3D9\\uD574\\uC8FC\\uC138\\uC694.\"}),/*#__PURE__*/_jsx(motion.div,{variants:varBounceIn,children:/*#__PURE__*/_jsx(Box,{component:\"img\",src:\"/static/illustrations/illustration_login.png\",sx:{height:260,mx:'auto',my:{xs:5,sm:10}}})}),/*#__PURE__*/_jsxs(Stack,{direction:\"row\",justifyContent:\"space-between\",sx:{ml:5,mr:5},children:[/*#__PURE__*/_jsx(Button,{to:\"/\",size:\"large\",color:\"inherit\",variant:\"contained\",component:RouterLink,sx:{fontSize:16},children:\"\\uADF8\\uB9CC\\uD558\\uAE30\"}),/*#__PURE__*/_jsx(Button,{to:\"/register/sale/\".concat(tokenId),size:\"large\",variant:\"contained\",component:RouterLink,children:\"\\uB2E4\\uC74C \\uD398\\uC774\\uC9C0\\uB85C\"})]})]})})})});};export default ItemRegistration;","map":{"version":3,"sources":["C:/SSAFY/WORKSPACE/NFT/S06P22A106/frontend/src/pages/ItemRegistration.js"],"names":["Yup","motion","LoadingButton","MotionContainer","varBounceIn","Box","Button","Card","Container","Divider","Modal","Stack","TextField","Typography","Form","FormikProvider","useFormik","useState","useRef","Link","RouterLink","axios","Web3","COMMON_ABI","COMMON_HEADER","onResponse","onContractCall","getAddressFrom","sendTransaction","Page","ItemRegistration","item","setItem","itemName","setItemName","itemSelect","author","setAuthor","title","setTitle","description","setDescription","tokenId","setTokenId","approveModal","setApproveModal","privKey","setPrivKey","loading","setLoading","isComplete","setIsComplete","web3","providers","HttpProvider","process","env","REACT_APP_ETHEREUM_RPC_URL","typeSchema","object","shape","string","required","formik","initialValues","validationSchema","onSubmit","value","errors","touched","handleSubmit","handleReset","getFieldProps","handleClick","current","click","handleItem","name","toggleApprove","handlePrivKey","e","target","addItem","pt","pl","pr","pb","files","length","display","width","ml","fontSize","maxLength","Boolean","mt","Object","keys","border","borderRadius","borderColor","backgroundColor","top","left","mr","mb","maxWidth","margin","textAlign","color","height","mx","my","xs","sm"],"mappings":"4gBAAA,MAAO,GAAKA,CAAAA,GAAZ,KAAqB,KAArB,CACA,OAASC,MAAT,KAAuB,eAAvB,CACA,OAASC,aAAT,KAA8B,UAA9B,CACA,OAASC,eAAT,CAA0BC,WAA1B,KAA6C,uBAA7C,CACA,OACEC,GADF,CAEEC,MAFF,CAGEC,IAHF,CAIEC,SAJF,CAKEC,OALF,CAMEC,KANF,CAOEC,KAPF,CAQEC,SARF,CASEC,UATF,KAUO,eAVP,CAWA,OAASC,IAAT,CAAeC,cAAf,CAA+BC,SAA/B,KAAgD,QAAhD,CACA,OAASC,QAAT,CAAmBC,MAAnB,KAAiC,OAAjC,CACA,OAASC,IAAI,GAAIC,CAAAA,UAAjB,KAAmC,kBAAnC,CACA,MAAOC,CAAAA,KAAP,KAAkB,OAAlB,CACA,MAAOC,CAAAA,IAAP,KAAiB,MAAjB,CACA,MAAOC,CAAAA,UAAP,KAAuB,eAAvB,CACA,MAAOC,CAAAA,aAAP,KAA0B,sBAA1B,CACA,OAASC,UAAT,CAAqBC,cAArB,KAA2C,wBAA3C,CACA,MAAOC,CAAAA,cAAP,KAA2B,2BAA3B,CACA,MAAOC,CAAAA,eAAP,KAA4B,mBAA5B,CACA,MAAOC,CAAAA,IAAP,KAAiB,oBAAjB,CAEA;AACA;AACA,G,wFACA,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,CAC7B;AACA,cAAwBb,QAAQ,CAAC,EAAD,CAAhC,wCAAOc,IAAP,eAAaC,OAAb,eACA,eAAgCf,QAAQ,CAAC,EAAD,CAAxC,yCAAOgB,QAAP,eAAiBC,WAAjB,eACA,GAAMC,CAAAA,UAAU,CAAGjB,MAAM,EAAzB,CACA,eAA4BD,QAAQ,CAAC,EAAD,CAApC,yCAAOmB,MAAP,eAAeC,SAAf,eACA,eAA0BpB,QAAQ,CAAC,EAAD,CAAlC,yCAAOqB,KAAP,eAAcC,QAAd,eACA,eAAsCtB,QAAQ,CAAC,EAAD,CAA9C,0CAAOuB,WAAP,gBAAoBC,cAApB,gBACA,gBAA8BxB,QAAQ,CAAC,EAAD,CAAtC,2CAAOyB,OAAP,gBAAgBC,UAAhB,gBAEA;AACA,gBAAwC1B,QAAQ,CAAC,KAAD,CAAhD,2CAAO2B,YAAP,gBAAqBC,eAArB,gBACA,gBAA8B5B,QAAQ,CAAC,EAAD,CAAtC,2CAAO6B,OAAP,gBAAgBC,UAAhB,gBACA,gBAA8B9B,QAAQ,CAAC,KAAD,CAAtC,2CAAO+B,OAAP,gBAAgBC,UAAhB,gBACA,gBAAoChC,QAAQ,CAAC,KAAD,CAA5C,2CAAOiC,UAAP,gBAAmBC,aAAnB,gBAEA;AACA,GAAMC,CAAAA,IAAI,CAAG,GAAI9B,CAAAA,IAAJ,CAAS,GAAIA,CAAAA,IAAI,CAAC+B,SAAL,CAAeC,YAAnB,CAAgCC,OAAO,CAACC,GAAR,CAAYC,0BAA5C,CAAT,CAAb,CAEA;AACA,GAAMC,CAAAA,UAAU,CAAG1D,GAAG,CAAC2D,MAAJ,GAAaC,KAAb,CAAmB,CACpCxB,MAAM,CAAEpC,GAAG,CAAC6D,MAAJ,GAAaC,QAAb,CAAsB,cAAtB,CAD4B,CAEpCxB,KAAK,CAAEtC,GAAG,CAAC6D,MAAJ,GAAaC,QAAb,CAAsB,aAAtB,CAF6B,CAAnB,CAAnB,CAKA;AACA,GAAMC,CAAAA,MAAM,CAAG/C,SAAS,CAAC,CACvBgD,aAAa,CAAE,CACb5B,MAAM,CAAE,EADK,CAEbE,KAAK,CAAE,EAFM,CAGbE,WAAW,CAAE,EAHA,CADQ,CAMvByB,gBAAgB,CAAEP,UANK,CAOvBQ,QAAQ,CAAE,kBAACC,KAAD,CAAW,CACnB9B,SAAS,CAAC8B,KAAK,CAAC/B,MAAP,CAAT,CACAG,QAAQ,CAAC4B,KAAK,CAAC7B,KAAP,CAAR,CACAG,cAAc,CAAC0B,KAAK,CAAC3B,WAAP,CAAd,CACD,CAXsB,CAAD,CAAxB,CAaA,GAAQ4B,CAAAA,MAAR,CAAsEL,MAAtE,CAAQK,MAAR,CAAgBC,OAAhB,CAAsEN,MAAtE,CAAgBM,OAAhB,CAAyBC,YAAzB,CAAsEP,MAAtE,CAAyBO,YAAzB,CAAuCC,WAAvC,CAAsER,MAAtE,CAAuCQ,WAAvC,CAAoDC,aAApD,CAAsET,MAAtE,CAAoDS,aAApD,CAEA;AACA,GAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAM,CACxBtC,UAAU,CAACuC,OAAX,CAAmBC,KAAnB,GACD,CAFD,CAIA;AACA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACT,KAAD,CAAW,CAC5BnC,OAAO,CAACmC,KAAD,CAAP,CAEA,GAAIA,KAAK,GAAK,EAAd,CAAkBjC,WAAW,CAACiC,KAAK,CAACU,IAAP,CAAX,CAAlB,IACK3C,CAAAA,WAAW,CAAC,EAAD,CAAX,CACN,CALD,CAOA;AACA,GAAM4C,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,EAAM,CAC1BjC,eAAe,CAAC,CAACD,YAAF,CAAf,CACD,CAFD,CAIA;AACA,GAAMmC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,CAAD,CAAO,CAC3BjC,UAAU,CAACiC,CAAC,CAACC,MAAF,CAASd,KAAV,CAAV,CACD,CAFD,CAIA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KACE,GAAMe,CAAAA,OAAO,0FAAG,kLAAH,kBAAPA,CAAAA,OAAO,0CAAb,CAIA,mBACE,KAAC,IAAD,EAAM,KAAK,CAAC,WAAZ,CAAwB,QAAQ,CAAC,MAAjC,CAAwC,SAAS,CAAC,MAAlD,UACGhC,UAAU,GAAK,KAAf,cACC,MAAC,SAAD,EAAW,EAAE,CAAE,CAAEiC,EAAE,CAAE,CAAN,CAASC,EAAE,CAAE,EAAb,CAAiBC,EAAE,CAAE,EAArB,CAAf,wBACE,KAAC,UAAD,EAAY,OAAO,CAAC,IAApB,CAAyB,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAN,CAASD,EAAE,CAAE,EAAb,CAA7B,yFADF,cAKE,KAAC,cAAD,EAAgB,KAAK,CAAEtB,MAAvB,uBACE,MAAC,IAAD,EAAM,YAAY,CAAC,KAAnB,CAAyB,UAAU,KAAnC,CAAoC,QAAQ,CAAEO,YAA9C,CAA4D,OAAO,CAAEC,WAArE,wBACE,MAAC,KAAD,EAAO,OAAO,CAAE,CAAhB,wBACE,MAAC,KAAD,EAAO,SAAS,CAAC,KAAjB,CAAuB,UAAU,CAAC,QAAlC,wBACE,cACE,IAAI,CAAC,MADP,CAEE,MAAM,CAAC,6CAFT,CAGE,GAAG,CAAEpC,UAHP,CAIE,QAAQ,CAAE,kBAAC6C,CAAD,QACRA,CAAAA,CAAC,CAACC,MAAF,CAASM,KAAT,CAAeC,MAAf,GAA0B,CAA1B,CAA8BZ,UAAU,CAACI,CAAC,CAACC,MAAF,CAASM,KAAT,CAAe,CAAf,CAAD,CAAxC,CAA8DX,UAAU,CAAC,EAAD,CADhE,EAJZ,CAOE,KAAK,CAAE,CAAEa,OAAO,CAAE,MAAX,CAPT,EADF,cAUE,KAAC,SAAD,EACE,EAAE,CAAE,CAAEC,KAAK,CAAE,KAAT,CADN,CAEE,IAAI,CAAC,MAFP,CAGE,KAAK,CAAC,8FAHR,CAIE,KAAK,CAAEzD,QAJT,CAKE,QAAQ,KALV,EAVF,cAiBE,KAAC,MAAD,EACE,EAAE,CAAE,CAAE0D,EAAE,CAAE,CAAN,CAASC,QAAQ,CAAE,EAAnB,CADN,CAEE,OAAO,CAAC,WAFV,CAGE,IAAI,CAAC,OAHP,CAIE,OAAO,CAAEnB,WAJX,0BAjBF,GADF,cA2BE,KAAC,SAAD,8BACE,EAAE,CAAE,CAAEiB,KAAK,CAAE,KAAT,CADN,CAEE,UAAU,CAAE,CAAEG,SAAS,CAAE,EAAb,CAFd,CAGE,IAAI,CAAC,MAHP,CAIE,KAAK,CAAC,oBAJR,EAKMrB,aAAa,CAAC,QAAD,CALnB,MAME,KAAK,CAAEsB,OAAO,CAACzB,OAAO,CAACjC,MAAR,EAAkBgC,MAAM,CAAChC,MAA1B,CANhB,CAOE,UAAU,CAAEiC,OAAO,CAACjC,MAAR,EAAkBgC,MAAM,CAAChC,MAPvC,GA3BF,cAoCE,KAAC,SAAD,8BACE,EAAE,CAAE,CAAEsD,KAAK,CAAE,KAAT,CADN,CAEE,UAAU,CAAE,CAAEG,SAAS,CAAE,GAAb,CAFd,CAGE,IAAI,CAAC,MAHP,CAIE,KAAK,CAAC,cAJR,EAKMrB,aAAa,CAAC,OAAD,CALnB,MAME,KAAK,CAAEsB,OAAO,CAACzB,OAAO,CAAC/B,KAAR,EAAiB8B,MAAM,CAAC9B,KAAzB,CANhB,CAOE,UAAU,CAAE+B,OAAO,CAAC/B,KAAR,EAAiB8B,MAAM,CAAC9B,KAPtC,GApCF,cA6CE,KAAC,SAAD,gBACE,EAAE,CAAE,CAAEoD,KAAK,CAAE,KAAT,CADN,CAEE,UAAU,CAAE,CAAEG,SAAS,CAAE,EAAb,CAFd,CAGE,IAAI,CAAC,MAHP,CAIE,SAAS,KAJX,CAKE,KAAK,CAAC,0CALR,EAMMrB,aAAa,CAAC,aAAD,CANnB,EA7CF,GADF,cAwDE,KAAC,OAAD,EAAS,EAAE,CAAE,CAAEuB,EAAE,CAAE,CAAN,CAASL,KAAK,CAAE,KAAhB,CAAb,EAxDF,cA0DE,MAAC,KAAD,EAAO,UAAU,CAAC,QAAlB,wBACE,KAAC,MAAD,EACE,EAAE,CAAE,CAAEK,EAAE,CAAE,CAAN,CAASL,KAAK,CAAE,KAAhB,CAAuBE,QAAQ,CAAE,EAAjC,CADN,CAEE,IAAI,CAAC,OAFP,CAGE,IAAI,CAAC,QAHP,CAIE,OAAO,CAAC,WAJV,CAKE,OAAO,CACLI,MAAM,CAACC,IAAP,CAAY5B,OAAZ,EAAqBmB,MAArB,EAA+B,CAACQ,MAAM,CAACC,IAAP,CAAY7B,MAAZ,EAAoBoB,MAApD,EAA8DzD,IAAI,CAACyD,MAAL,GAAgB,CAA9E,CACIV,aADJ,CAEI,IARR,0BADF,cAeE,KAAC,KAAD,EAAO,IAAI,CAAElC,YAAb,uBACE,MAAC,IAAD,EACE,EAAE,CAAE,CACF8C,KAAK,CAAE,KADL,CAEFQ,MAAM,CAAE,CAFN,CAGFC,YAAY,CAAE,CAHZ,CAIFC,WAAW,CAAE,WAJX,CAKFC,eAAe,CAAE,SALf,CAMFC,GAAG,CAAE,KANH,CAOFC,IAAI,CAAE,KAPJ,CADN,wBAWE,KAAC,GAAD,wBACE,KAAC,UAAD,EAAY,EAAE,CAAE,CAAEZ,EAAE,CAAE,CAAN,CAASR,EAAE,CAAE,CAAb,CAAhB,CAAkC,OAAO,CAAC,IAA1C,mDADF,EAXF,cAgBE,KAAC,OAAD,EAAS,EAAE,CAAE,CAAEY,EAAE,CAAE,CAAN,CAAb,EAhBF,cAiBE,KAAC,cAAD,EAAgB,KAAK,CAAEhC,MAAvB,uBACE,KAAC,IAAD,EACE,YAAY,CAAC,KADf,CAEE,UAAU,KAFZ,CAGE,QAAQ,CAAEO,YAHZ,CAIE,OAAO,CAAEC,WAJX,uBAME,MAAC,GAAD,EAAK,EAAE,CAAE,CAAEwB,EAAE,CAAE,CAAN,CAASJ,EAAE,CAAE,CAAb,CAAgBa,EAAE,CAAE,CAApB,CAAT,wBACE,KAAC,KAAD,EAAO,SAAS,CAAC,KAAjB,CAAuB,EAAE,CAAE,CAAET,EAAE,CAAE,CAAN,CAA3B,uBACE,KAAC,SAAD,EACE,SAAS,KADX,CAEE,IAAI,CAAC,MAFP,CAGE,KAAK,CAAC,oBAHR,CAIE,QAAQ,CAAEhB,aAJZ,CAKE,KAAK,CAAEjC,OALT,EADF,EADF,cAUE,KAAC,OAAD,EAAS,EAAE,CAAE,CAAEiD,EAAE,CAAE,CAAN,CAAb,EAVF,cAWE,MAAC,KAAD,EAAO,SAAS,CAAC,KAAjB,CAAuB,EAAE,CAAE,CAAEA,EAAE,CAAE,CAAN,CAASU,EAAE,CAAE,CAAb,CAA3B,CAA6C,cAAc,CAAC,QAA5D,WACGzD,OAAO,GAAK,KAAZ,cACC,KAAC,MAAD,EACE,IAAI,CAAC,OADP,CAEE,OAAO,CAAC,WAFV,CAGE,EAAE,CAAE,CAAE0C,KAAK,CAAE,KAAT,CAAgBE,QAAQ,CAAE,EAA1B,CAHN,CAIE,OAAO,CAAEd,aAJX,0BADD,CASG,IAVN,cAWE,KAAC,aAAD,EACE,IAAI,CAAC,OADP,CAEE,OAAO,CAAC,WAFV,CAGE,EAAE,CAAE,CAAEa,EAAE,CAAE,CAAN,CAASD,KAAK,CAAE,KAAhB,CAAuBE,QAAQ,CAAE,EAAjC,CAHN,CAIE,OAAO,CAAE5C,OAJX,CAKE,OAAO,CAAEkC,OALX,sCAXF,GAXF,GANF,EADF,EAjBF,GADF,EAfF,GA1DF,GADF,EALF,GADD,cAmJC,KAAC,SAAD,wBACE,KAAC,eAAD,EAAiB,OAAO,CAAC,SAAzB,CAAmC,EAAE,CAAE,CAAEa,EAAE,CAAE,CAAN,CAAvC,CAAkD,IAAI,KAAtD,uBACE,MAAC,GAAD,EAAK,EAAE,CAAE,CAAEW,QAAQ,CAAE,GAAZ,CAAiBC,MAAM,CAAE,MAAzB,CAAiCC,SAAS,CAAE,QAA5C,CAAT,wBACE,KAAC,MAAD,CAAQ,GAAR,EAAY,QAAQ,CAAExG,WAAtB,uBACE,KAAC,UAAD,EAAY,OAAO,CAAC,IAApB,CAAyB,SAAS,KAAlC,+FADF,EADF,cAME,KAAC,UAAD,EAAY,EAAE,CAAE,CAAEyG,KAAK,CAAE,gBAAT,CAAhB,qKANF,cAUE,KAAC,MAAD,CAAQ,GAAR,EAAY,QAAQ,CAAEzG,WAAtB,uBACE,KAAC,GAAD,EACE,SAAS,CAAC,KADZ,CAEE,GAAG,CAAC,8CAFN,CAGE,EAAE,CAAE,CAAE0G,MAAM,CAAE,GAAV,CAAeC,EAAE,CAAE,MAAnB,CAA2BC,EAAE,CAAE,CAAEC,EAAE,CAAE,CAAN,CAASC,EAAE,CAAE,EAAb,CAA/B,CAHN,EADF,EAVF,cAkBE,MAAC,KAAD,EAAO,SAAS,CAAC,KAAjB,CAAuB,cAAc,CAAC,eAAtC,CAAsD,EAAE,CAAE,CAAEvB,EAAE,CAAE,CAAN,CAASa,EAAE,CAAE,CAAb,CAA1D,wBACE,KAAC,MAAD,EACE,EAAE,CAAC,GADL,CAEE,IAAI,CAAC,OAFP,CAGE,KAAK,CAAC,SAHR,CAIE,OAAO,CAAC,WAJV,CAKE,SAAS,CAAEpF,UALb,CAME,EAAE,CAAE,CAAEwE,QAAQ,CAAE,EAAZ,CANN,sCADF,cAWE,KAAC,MAAD,EACE,EAAE,0BAAoBlD,OAApB,CADJ,CAEE,IAAI,CAAC,OAFP,CAGE,OAAO,CAAC,WAHV,CAIE,SAAS,CAAEtB,UAJb,mDAXF,GAlBF,GADF,EADF,EApJJ,EADF,CAmMD,CApRD,CAsRA,cAAeU,CAAAA,gBAAf","sourcesContent":["import * as Yup from 'yup';\r\nimport { motion } from 'framer-motion';\r\nimport { LoadingButton } from '@mui/lab';\r\nimport { MotionContainer, varBounceIn } from '../components/animate';\r\nimport {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  Container,\r\n  Divider,\r\n  Modal,\r\n  Stack,\r\n  TextField,\r\n  Typography\r\n} from '@mui/material';\r\nimport { Form, FormikProvider, useFormik } from 'formik';\r\nimport { useState, useRef } from 'react';\r\nimport { Link as RouterLink } from 'react-router-dom';\r\nimport axios from 'axios';\r\nimport Web3 from 'web3';\r\nimport COMMON_ABI from '../common/ABI';\r\nimport COMMON_HEADER from '../common/HeaderType';\r\nimport { onResponse, onContractCall } from '../common/ErrorMessage';\r\nimport getAddressFrom from '../utils/AddressExtractor';\r\nimport sendTransaction from '../utils/TxSender';\r\nimport Page from '../components/Page';\r\n\r\n/**\r\n * [등록하기]를 위한 UI와 기능\r\n */\r\nconst ItemRegistration = () => {\r\n  // [변수] 아이템 (파일, 이름, input 클릭 참조), 작가명, 제목, 아이템 소개, 토큰 ID\r\n  const [item, setItem] = useState('');\r\n  const [itemName, setItemName] = useState('');\r\n  const itemSelect = useRef();\r\n  const [author, setAuthor] = useState('');\r\n  const [title, setTitle] = useState('');\r\n  const [description, setDescription] = useState('');\r\n  const [tokenId, setTokenId] = useState('');\r\n\r\n  // [변수] 등록 승인 모달 (모달, 개인키, 등록 로딩, 완료 여부)\r\n  const [approveModal, setApproveModal] = useState(false);\r\n  const [privKey, setPrivKey] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [isComplete, setIsComplete] = useState(false);\r\n\r\n  // Web3\r\n  const web3 = new Web3(new Web3.providers.HttpProvider(process.env.REACT_APP_ETHEREUM_RPC_URL));\r\n\r\n  // 타이핑 헬퍼\r\n  const typeSchema = Yup.object().shape({\r\n    author: Yup.string().required('작가명을 입력해주세요.'),\r\n    title: Yup.string().required('제목을 입력해주세요.')\r\n  });\r\n\r\n  // 입력 데이터 처리\r\n  const formik = useFormik({\r\n    initialValues: {\r\n      author: '',\r\n      title: '',\r\n      description: ''\r\n    },\r\n    validationSchema: typeSchema,\r\n    onSubmit: (value) => {\r\n      setAuthor(value.author);\r\n      setTitle(value.title);\r\n      setDescription(value.description);\r\n    }\r\n  });\r\n  const { errors, touched, handleSubmit, handleReset, getFieldProps } = formik;\r\n\r\n  // 찾기 버튼 클릭 핸들링\r\n  const handleClick = () => {\r\n    itemSelect.current.click();\r\n  };\r\n\r\n  // 아이템 업로드 핸들링\r\n  const handleItem = (value) => {\r\n    setItem(value);\r\n\r\n    if (value !== '') setItemName(value.name);\r\n    else setItemName('');\r\n  };\r\n\r\n  // 모달 핸들링 (등록 승인)\r\n  const toggleApprove = () => {\r\n    setApproveModal(!approveModal);\r\n  };\r\n\r\n  // 개인키 입력 핸들링\r\n  const handlePrivKey = (e) => {\r\n    setPrivKey(e.target.value);\r\n  };\r\n\r\n  /**\r\n   * PJT Ⅱ - 과제 1: 작품 등록 및 NFT 생성 \r\n   * Req.1-F1 작품 등록 화면 및 등록 요청 \r\n   * \r\n   * 구현 예)\r\n   * 1. 아이템 업로드 및 모든 정보가 입력되면 등록 승인을 위한 모달창이 열립니다.\r\n   * 2. 해당 모달 창에서 개인키를 입력하면 getAddressFrom() 함수를 통해 공개키가 반환되며, 공개키가 유효한 경우 작가명, 제목,\r\n   * 아이템 소개 정보를 인코딩하여 formData에 아이템의 이미지와 함께 append 합니다.\r\n   * 3. 만들어진 formData는 아이템 등록 API를 통해 전달되고, 정상적으로 반영된 경우 이미지의 링크와 item ID를 반환 받습니다.\r\n   * 4. 이후 공개키와 생성된 item ID, 이미지 링크를 이용해 NFT 생성을 위한 함수를 호출합니다.\r\n   * 정상적으로 트랜잭션이 완결된 후 token Id가 반환됩니다.\r\n   * 5. 정상 동작 시 token Id와 owner_address를 백엔드에 업데이트 요청합니다.  \r\n   */\r\n  const addItem = async () => {\r\n    // TODO\r\n  };\r\n\r\n  return (\r\n    <Page title=\"SSAFY NFT\" maxWidth=\"100%\" minHeight=\"100%\">\r\n      {isComplete === false ? (\r\n        <Container sx={{ pt: 3, pl: 10, pr: 10 }}>\r\n          <Typography variant=\"h3\" sx={{ pb: 6, pr: 10 }}>\r\n            당신의 아이템을 등록하세요.\r\n          </Typography>\r\n\r\n          <FormikProvider value={formik}>\r\n            <Form autoComplete=\"off\" noValidate onSubmit={handleSubmit} onReset={handleReset}>\r\n              <Stack spacing={3}>\r\n                <Stack direction=\"row\" alignItems=\"center\">\r\n                  <input\r\n                    type=\"file\"\r\n                    accept=\"image/png, image/jpeg, image/jpg, image/gif\"\r\n                    ref={itemSelect}\r\n                    onChange={(e) =>\r\n                      e.target.files.length !== 0 ? handleItem(e.target.files[0]) : handleItem('')\r\n                    }\r\n                    style={{ display: 'none' }}\r\n                  />\r\n                  <TextField\r\n                    sx={{ width: '60%' }}\r\n                    type=\"text\"\r\n                    label=\"아이템 (업로드 확장자 형식: png, jpeg, jpg, gif)\"\r\n                    value={itemName}\r\n                    disabled\r\n                  />\r\n                  <Button\r\n                    sx={{ ml: 5, fontSize: 18 }}\r\n                    variant=\"contained\"\r\n                    size=\"large\"\r\n                    onClick={handleClick}\r\n                  >\r\n                    찾기\r\n                  </Button>\r\n                </Stack>\r\n                <TextField\r\n                  sx={{ width: '70%' }}\r\n                  inputProps={{ maxLength: 20 }}\r\n                  type=\"text\"\r\n                  label=\"작가명\"\r\n                  {...getFieldProps('author')}\r\n                  error={Boolean(touched.author && errors.author)}\r\n                  helperText={touched.author && errors.author}\r\n                />\r\n                <TextField\r\n                  sx={{ width: '70%' }}\r\n                  inputProps={{ maxLength: 140 }}\r\n                  type=\"text\"\r\n                  label=\"제목\"\r\n                  {...getFieldProps('title')}\r\n                  error={Boolean(touched.title && errors.title)}\r\n                  helperText={touched.title && errors.title}\r\n                />\r\n                <TextField\r\n                  sx={{ width: '70%' }}\r\n                  inputProps={{ maxLength: 20 }}\r\n                  type=\"text\"\r\n                  multiline\r\n                  label=\"아이템 소개 (Option)\"\r\n                  {...getFieldProps('description')}\r\n                />\r\n              </Stack>\r\n\r\n              <Divider sx={{ mt: 5, width: '70%' }} />\r\n\r\n              <Stack alignItems=\"center\">\r\n                <Button\r\n                  sx={{ mt: 5, width: '40%', fontSize: 18 }}\r\n                  size=\"large\"\r\n                  type=\"submit\"\r\n                  variant=\"contained\"\r\n                  onClick={\r\n                    Object.keys(touched).length && !Object.keys(errors).length && item.length !== 0\r\n                      ? toggleApprove\r\n                      : null\r\n                  }\r\n                >\r\n                  등록\r\n                </Button>\r\n\r\n                <Modal open={approveModal}>\r\n                  <Card\r\n                    sx={{\r\n                      width: '40%',\r\n                      border: 1,\r\n                      borderRadius: 1,\r\n                      borderColor: 'grey.main',\r\n                      backgroundColor: '#ffffff',\r\n                      top: '25%',\r\n                      left: '30%'\r\n                    }}\r\n                  >\r\n                    <Box>\r\n                      <Typography sx={{ ml: 3, pt: 2 }} variant=\"h5\">\r\n                        등록 승인하기\r\n                      </Typography>\r\n                    </Box>\r\n                    <Divider sx={{ mt: 2 }} />\r\n                    <FormikProvider value={formik}>\r\n                      <Form\r\n                        autoComplete=\"off\"\r\n                        noValidate\r\n                        onSubmit={handleSubmit}\r\n                        onReset={handleReset}\r\n                      >\r\n                        <Box sx={{ mt: 4, ml: 3, mr: 3 }}>\r\n                          <Stack direction=\"row\" sx={{ mt: 3 }}>\r\n                            <TextField\r\n                              fullWidth\r\n                              type=\"text\"\r\n                              label=\"개인키\"\r\n                              onChange={handlePrivKey}\r\n                              value={privKey}\r\n                            />\r\n                          </Stack>\r\n                          <Divider sx={{ mt: 4 }} />\r\n                          <Stack direction=\"row\" sx={{ mt: 3, mb: 3 }} justifyContent=\"center\">\r\n                            {loading === false ? (\r\n                              <Button\r\n                                size=\"large\"\r\n                                variant=\"contained\"\r\n                                sx={{ width: '20%', fontSize: 16 }}\r\n                                onClick={toggleApprove}\r\n                              >\r\n                                취소\r\n                              </Button>\r\n                            ) : null}\r\n                            <LoadingButton\r\n                              size=\"large\"\r\n                              variant=\"contained\"\r\n                              sx={{ ml: 3, width: '20%', fontSize: 16 }}\r\n                              loading={loading}\r\n                              onClick={addItem}\r\n                            >\r\n                              승인하기\r\n                            </LoadingButton>\r\n                          </Stack>\r\n                        </Box>\r\n                      </Form>\r\n                    </FormikProvider>\r\n                  </Card>\r\n                </Modal>\r\n              </Stack>\r\n            </Form>\r\n          </FormikProvider>\r\n        </Container>\r\n      ) : (\r\n        <Container>\r\n          <MotionContainer initial=\"initial\" sx={{ mt: 5 }} open>\r\n            <Box sx={{ maxWidth: 480, margin: 'auto', textAlign: 'center' }}>\r\n              <motion.div variants={varBounceIn}>\r\n                <Typography variant=\"h3\" paragraph>\r\n                  아이템 등록이 완료되었습니다.\r\n                </Typography>\r\n              </motion.div>\r\n              <Typography sx={{ color: 'text.secondary' }}>\r\n                판매 등록을 이어서 하시려면 다음 페이지로 이동해주세요.\r\n              </Typography>\r\n\r\n              <motion.div variants={varBounceIn}>\r\n                <Box\r\n                  component=\"img\"\r\n                  src=\"/static/illustrations/illustration_login.png\"\r\n                  sx={{ height: 260, mx: 'auto', my: { xs: 5, sm: 10 } }}\r\n                />\r\n              </motion.div>\r\n\r\n              <Stack direction=\"row\" justifyContent=\"space-between\" sx={{ ml: 5, mr: 5 }}>\r\n                <Button\r\n                  to=\"/\"\r\n                  size=\"large\"\r\n                  color=\"inherit\"\r\n                  variant=\"contained\"\r\n                  component={RouterLink}\r\n                  sx={{ fontSize: 16 }}\r\n                >\r\n                  그만하기\r\n                </Button>\r\n                <Button\r\n                  to={`/register/sale/${tokenId}`}\r\n                  size=\"large\"\r\n                  variant=\"contained\"\r\n                  component={RouterLink}\r\n                >\r\n                  다음 페이지로\r\n                </Button>\r\n              </Stack>\r\n            </Box>\r\n          </MotionContainer>\r\n        </Container>\r\n      )}\r\n    </Page>\r\n  );\r\n};\r\n\r\nexport default ItemRegistration;\r\n"]},"metadata":{},"sourceType":"module"}